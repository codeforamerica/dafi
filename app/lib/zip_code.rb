require 'csv'

class ZipCode
  DATA_CSV_PATH = Rails.root.join('app/lib/data/zip_to_county_fips_relationships.csv')

  def self.csv_data
    @csv_data ||= CSV.read(DATA_CSV_PATH, headers: true)
  end

  def initialize(code)
    @code = code.to_s
  end

  def counties(usps_only: false)
    (usps_only ? nil : overrides[@code]) || fips_code_matches.map { |fips_code| FIPS_CODE_TO_COUNTY[fips_code] }.flatten
  end

  private

  def overrides
    OVERRIDES
  end

  def fips_code_matches
    self.class.csv_data.select { |row| row["zip_code"] == @code }.map { |row| row["county_fips_code"] }
  end

  FIPS_CODE_TO_COUNTY = {
    "6001"=>"Alameda",
    "6003"=>"Alpine",
    "6005"=>"Amador",
    "6007"=>"Butte",
    "6009"=>"Calaveras",
    "6011"=>"Colusa",
    "6013"=>"Contra Costa",
    "6015"=>"Del Norte",
    "6017"=>"El Dorado",
    "6019"=>"Fresno",
    "6021"=>"Glenn",
    "6023"=>"Humboldt",
    "6025"=>"Imperial",
    "6027"=>"Inyo",
    "6029"=>"Kern",
    "6031"=>"Kings",
    "6033"=>"Lake",
    "6035"=>"Lassen",
    "6037"=>"Los Angeles",
    "6039"=>"Madera",
    "6041"=>"Marin",
    "6043"=>"Mariposa",
    "6045"=>"Mendocino",
    "6047"=>"Merced",
    "6049"=>"Modoc",
    "6051"=>"Mono",
    "6053"=>"Monterey",
    "6055"=>"Napa",
    "6057"=>"Nevada",
    "6059"=>"Orange",
    "6061"=>"Placer",
    "6063"=>"Plumas",
    "6065"=>"Riverside",
    "6067"=>"Sacramento",
    "6069"=>"San Benito",
    "6071"=>"San Bernardino",
    "6073"=>"San Diego",
    "6075"=>"San Francisco",
    "6077"=>"San Joaquin",
    "6079"=>"San Luis Obispo",
    "6081"=>"San Mateo",
    "6083"=>"Santa Barbara",
    "6085"=>"Santa Clara",
    "6087"=>"Santa Cruz",
    "6089"=>"Shasta",
    "6091"=>"Sierra",
    "6093"=>"Siskiyou",
    "6095"=>"Solano",
    "6097"=>"Sonoma",
    "6099"=>"Stanislaus",
    "6101"=>"Sutter",
    "6103"=>"Tehama",
    "6105"=>"Trinity",
    "6107"=>"Tulare",
    "6109"=>"Tuolumne",
    "6111"=>"Ventura",
    "6113"=>"Yolo",
    "6115"=>"Yuba"
  }.freeze

  ZIP_CODES_DOT_COM_OVERRIDES = {
    '90080' => ['Los Angeles'],
    '90088' => ['Los Angeles'],
    '90096' => ['Los Angeles'],
    '90134' => ['Los Angeles'],
    '90189' => ['Los Angeles'],
    '90233' => ['Los Angeles'],
    '90311' => ['Los Angeles'],
    '90312' => ['Los Angeles'],
    '90407' => ['Los Angeles'],
    '90410' => ['Los Angeles'],
    '90411' => ['Los Angeles'],
    '90834' => ['Los Angeles'],
    '90835' => ['Los Angeles'],
    '90842' => ['Los Angeles'],
    '90847' => ['Los Angeles'],
    '90848' => ['Los Angeles'],
    '91110' => ['Los Angeles'],
    '91410' => ['Los Angeles'],
    '91526' => ['Los Angeles'],
    '91616' => ['Los Angeles'],
    '91618' => ['Los Angeles'],
    '91735' => ['Los Angeles'],
    '91749' => ['Los Angeles'],
    '91758' => ['San Bernardino'],
    '91909' => ['San Diego'],
    '91987' => ['San Diego'],
    '92186' => ['San Diego'],
    '92187' => ['San Diego'],
    '92554' => ['Riverside'],
    '92712' => ['Orange'],
    '92850' => ['Orange'],
    '93107' => ['Santa Barbara'],
    '93216' => ['Kern'],
    '93282' => ['Tulare'],
    '93383' => ['Kern'],
    '93519' => ['Kern'],
    '93542' => ['Inyo'],
    '93558' => ['Kern'],
    '93596' => ['Kern'],
    '93607' => ['Fresno'],
    '94016' => ['San Mateo'],
    '94120' => ['San Francisco'],
    '94125' => ['San Francisco'],
    '94137' => ['San Francisco'],
    '94139' => ['San Francisco'],
    '94142' => ['San Francisco'],
    '94144' => ['San Francisco'],
    '94145' => ['San Francisco'],
    '94151' => ['San Francisco'],
    '94160' => ['San Francisco'],
    '94161' => ['San Francisco'],
    '94163' => ['San Francisco'],
    '94172' => ['San Francisco'],
    '94177' => ['San Francisco'],
    '94203' => ['Sacramento'],
    '94204' => ['Sacramento'],
    '94205' => ['Sacramento'],
    '94206' => ['Sacramento'],
    '94207' => ['Sacramento'],
    '94208' => ['Sacramento'],
    '94209' => ['Sacramento'],
    '94211' => ['Sacramento'],
    '94229' => ['Sacramento'],
    '94230' => ['Sacramento'],
    '94232' => ['Sacramento'],
    '94234' => ['Sacramento'],
    '94235' => ['Sacramento'],
    '94236' => ['Sacramento'],
    '94237' => ['Sacramento'],
    '94239' => ['Sacramento'],
    '94240' => ['Sacramento'],
    '94244' => ['Sacramento'],
    '94245' => ['Sacramento'],
    '94247' => ['Sacramento'],
    '94248' => ['Sacramento'],
    '94249' => ['Sacramento'],
    '94250' => ['Sacramento'],
    '94252' => ['Sacramento'],
    '94254' => ['Sacramento'],
    '94256' => ['Sacramento'],
    '94257' => ['Sacramento'],
    '94258' => ['Sacramento'],
    '94259' => ['Sacramento'],
    '94261' => ['Sacramento'],
    '94262' => ['Sacramento'],
    '94263' => ['Sacramento'],
    '94267' => ['Sacramento'],
    '94268' => ['Sacramento'],
    '94269' => ['Sacramento'],
    '94271' => ['Sacramento'],
    '94273' => ['Sacramento'],
    '94274' => ['Sacramento'],
    '94277' => ['Sacramento'],
    '94278' => ['Sacramento'],
    '94279' => ['Sacramento'],
    '94280' => ['Sacramento'],
    '94282' => ['Sacramento'],
    '94283' => ['Sacramento'],
    '94284' => ['Sacramento'],
    '94285' => ['Sacramento'],
    '94287' => ['Sacramento'],
    '94288' => ['Sacramento'],
    '94289' => ['Sacramento'],
    '94290' => ['Sacramento'],
    '94291' => ['Sacramento'],
    '94293' => ['Sacramento'],
    '94294' => ['Sacramento'],
    '94295' => ['Sacramento'],
    '94296' => ['Sacramento'],
    '94297' => ['Sacramento'],
    '94298' => ['Sacramento'],
    '94299' => ['Sacramento'],
    '94309' => ['Santa Clara'],
    '94527' => ['Contra Costa'],
    '94529' => ['Contra Costa'],
    '94617' => ['Alameda'],
    '94622' => ['Alameda'],
    '94649' => ['Alameda'],
    '94659' => ['Alameda'],
    '94660' => ['Alameda'],
    '94808' => ['Contra Costa'],
    '94926' => ['Sonoma'],
    '94998' => ['Marin'],
    '95042' => ['Santa Clara'],
    '95053' => ['Santa Clara'],
    '95115' => ['Santa Clara'],
    '95190' => ['Santa Clara'],
    '95193' => ['Santa Clara'],
    '95194' => ['Santa Clara'],
    '95196' => ['Santa Clara'],
    '95214' => ['San Joaquin'],
    '95296' => ['San Joaquin'],
    '95297' => ['San Joaquin'],
    '95644' => ['Amador'],
    '95646' => ['Alpine'],
    '95724' => ['Nevada'],
    '95899' => ['Sacramento'],
    '96070' => ['Shasta'],
    '96079' => ['Shasta'],
    '96152' => ['El Dorado'],
    '96154' => ['El Dorado'],
    '96156' => ['El Dorado'],
    '96157' => ['El Dorado'],
  }

  CUSTOM_OVERIDES = {
    '93592' => ["San Bernardino"],
    '95563' => ["Trinity"],
  }

  OVERRIDES = ZIP_CODES_DOT_COM_OVERRIDES.merge(CUSTOM_OVERIDES)
end
